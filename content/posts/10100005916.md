---
author: 农步祥
categories:
- 移动数码
- 数码设备
- 评论
- 数码附件
cover:
  alt: ''
  caption: ''
  image: https://images.soomal.cc/images/doc/20150628/00052788.webp
  relative: false
date: '2015-06-28T21:37:49+08:00'
description: 网络安全 | 路由器 | MIWIFI | 源自： | 版权：原创 |  平均/总评分：09.67/1654
summary: 最近几天，关于小米路由器“劫持”网页的消息出现于网络，称小米路由器系统将所有HTTP协议的403、404错误代码强制跳转至广告页面。 而小米也针对性发出了声明，称这是竞争对手的恶意炒作和煽动。实际的情况又是如何？
tags:
- xiaomi
- 小米
title: 安全提示：小米路由器的HTTP劫持行为分析
---

最近几天，关于小米路由器“劫持”网页的消息出现于网络，称小米路由器系统将所有HTTP协议的403、404错误代码强制跳转至广告页面。 而小米也针对性发出了声明，称这是竞争对手的恶意炒作和煽动：



![关于小米路由器的的官方声明](https://images.soomal.cc/images/doc/20150628/00052785.webp)



可以看出，小米的确承认了其路由确实有改写网页代码的行为[加入快捷搜索]，并将其称之为改善用户体验。具体情况是如何？我们拿出尘封半年的小米路由，更新至最新稳定版固件进行了实践。为了方便比较，我们还同时使用一台NETGEAR的R7000无线路由器进行即时的切换和对比，同样升级至最新固件。



![xiaomi 小米 MIWIFI 小米路由器](https://images.soomal.cc/images/doc/20140219/00040448_01.webp)



![NetGear 网件 R7000 无线路由器](https://images.soomal.cc/images/doc/20140806/00044696_01.webp)



一般来说，用户浏览的网页是以标准的HTTP协议进行工作的，当用户访问的网站内容不存在或者无效、服务器错误等，会返回一个代号为403、404、500等标记的HTML页面，通常这些错误页面的内容同样由网站服务器提供，这里以一个特定网站做为栗子，首先，我们在R7000和小米路由器上分别输入一个相同的错误网页地址：



![访问错误网址 - 使用NETGEAR R7000路由器](https://images.soomal.cc/images/doc/20150628/00052749_01.webp)



![访问错误网址 - 使用小米路由器](https://images.soomal.cc/images/doc/20150628/00052750_01.webp)



可以看到，无论是网页地址还是内容均截然不同，在使用小米路由器时，所有HTTP错误页面被强制跳转至api.miwifi.com/error-page.html这个网页地址。不过，引起轩然大波和用户愤怒主要是因为这个强制跳转的页面原来的内容要比现在“丰富”得多，大量的广告链接信息自然引起了小米路由器用户的强烈不满。



![访问错误网址 - 使用小米路由器[截图来自互联网]](https://images.soomal.cc/images/doc/20150628/00052773.webp)



什么叫网页劫持？其实网页劫持有多种方式，主要一种是基于客户端操作系统和浏览器工作的各类插件、病毒木马等，对客户端浏览器的页面进行强制改写代码，例如使用搜狗、腾讯等浏览器时会自行跳转到Hao123等各类导航网站上，甚至是篡改正常网页内容，下载各种可执行应用程序等等，达到强制收藏、浏览、下载安装的效果。正如小米的声明所说，这也是各类国产第三方浏览器常见的行为。



小米路由器的修改代码手段则属于另一类，可称为HTTP劫持，简单的说就是路由器通过ISP网络运营商[ADSL、小区光纤等]获得网页数据时，直接修改数据再传输至客户端。IT码农们应该会对五六年前的各类局域网的ARP攻击印象深刻，从技术上来说，小米路由器的修改网页的技术手段和这类ARP攻击欺骗没有区别，路由器自身还可省去网关伪装等工作。其注入的具体代码，在MIUI论坛上就有小米路由器的用户提供过。



![小米路由器手机客户端 - 信息](https://images.soomal.cc/images/doc/20150628/00052780_01.webp)



![小米路由器手机客户端 - 开启网页消息提示](https://images.soomal.cc/images/doc/20150628/00052781_01.webp)



![小米路由器手机客户端 - 工具箱](https://images.soomal.cc/images/doc/20150628/00052782_01.webp)



![小米路由器手机客户端 - 购物党比价](https://images.soomal.cc/images/doc/20150628/00052783_01.webp)



这个功能如何关闭？厂商表示可修改，但这个选项有些隐蔽，用户必须在手机上下载安装小米路由的手机客户端，在路由器设置->关于里开启“网页调试选项”即可，这个选项提示只有序员才能看得懂，对普通用户存在一定的误导。是不是这样就可以解决了呢？我们发现小米路由的固件确实提供了许多奇奇怪怪的网页辅助功能，比如这个“购物党比价”插件，在激活后，用户在浏览器访问京东时会变成这个样子：



![访问京东网站](https://images.soomal.cc/images/doc/20150628/00052775_01.webp)



![访问京东网站 - 使用小米路由器的购物党比价插件](https://images.soomal.cc/images/doc/20150628/00052776_01.webp)



![访问京东网站 - 网页代码](https://images.soomal.cc/images/doc/20150628/00052778_01.webp)



![访问京东网站 - 被小米路由器插件注入了Javascript代码](https://images.soomal.cc/images/doc/20150628/00052779_01.webp)



可以看到，网页左下角多了一个工具条，而且在京东的商品链接和页面中，出现了鼠标悬停的提示信息，这些并不是京东网站提供的内容和功能，而是来自这个购物插件的开发者指定的网站。通过查看网页代码，可以看到在最末尾，京东网页的代码末尾被小米路由器修改插入了一段Javascript代码，实现以上的功能。其工作原理和路由内置修改HTTP错误代码页面完全一致，当然，据用户反应，小米路由的开发版固件甚至会在豆瓣等网站的页面顶部显示APP下载和推荐信息……或许会有人认为这些功能存在一定实用价值，但如果一个不知情的用户，使用国产浏览器同样对网页进行代码注入和修改导致页面严重错误，那画面太美不敢想，而且这些代码不仅能改变网页内容，还可以收集用户浏览器信息，如用户的网站登录信息、Cookie等涉及个人隐私和经济安全的数据。而且，注入的代码出现了语法问题，容易导致浏览器显示页面错误，显得太业余。



![小米路由器HTTP代码修改片段 - 来自MIUI论坛网站](https://images.soomal.cc/images/doc/20150628/00052787.webp)



此次HTTP劫持行为，其动机是通过流量访问控制、应用装机率带来的经济效益，路由器作为家庭和企网络的核心，可以轻松对电脑、平板手机、智能电视等设备进行内容控制。从安全角度来看，在路由器这样的关键网络设备中“内置”HTTP劫持功能，这种做法对家庭和办公信息带来严重的安全隐患。或许小米可以自律，但若有内鬼或插件开发者不安分，非法收集小米路由的用户敏感数据，或是直接注入恶意代码进行攻击，以目前小米路由器的用户数量和特点，其后果不堪设想。小米经常自慰自己并不是一家做坏事的公司，但其品牌影响力和对行业风气影响无疑已经造成了恶劣影响。正如小米营销策略中同样的低节操，起坏头吸引关注而扰乱传统市场。可怕的是，从声明的态度来看，小米路由并不打算改变这种习惯。无论是NETGEAR R7000或小米这样的高端家用路由器，在功能和性能上都有许多值得吐槽的地方，但小米的植入行为，无法让人信任。